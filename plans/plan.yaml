---
table:
   AuditorA: YAkJunLY0Pv3AjZHD++blx5PKOYydceseKmejkQqCGA=
   EventA: Y6kVMKeW16Q8oNCGqlfCr12w5jaIzaJeoC+vfZIvb24=
   BucketA: GMpLkzapjAZTy/ggQju8PE4UjvmZmD30ZwICPB706d0=
   BucketB: tYsxMWCUQxpgfz+uVZk/WBC+/clQQevcrckBohUK14U=
   Data001: somehash
   A: 5
   B: 3
   M: Mars
    
actions:
  - on: "_"
    name: start
    do:
     - print: "{{me}}"
     - event:
           eventName: "{{me}}.e.start1"
           eventType: "String"
           eventValue: "'Hello World'"
     - event:
           eventName: "{{me}}.e.start2"
           eventType: "String"
           eventValue: "'Hello ' + {{M}}"
  - on: "E.{{EventA}}.e.codeRed || (E.{{EventA}}.e.codeOrange && E.{{EventA}}.e.codeYellow)"
    name: action1
    timeWindow: 5
    resetAfter: 30
    do:
     - expr: "{{C}} = {{A}} + {{B}}" 
     - print: "{{C}}"  
     - function: "{{AuditorA}}.f.sign"
       params:
           actionOnSource: send
           actionOnDestination: receive
           sourceActor: "{{BucketA}}"
           destinationActor: "{{BucketB}}"
           dataset: "{{Data001}}"
       return:
           ref: tokenA
           codes:
               200:
                - eventName: "{{me}}.e.signA"
                  eventType: "String"
                  eventValue: "{{tokenA}}"
                - eventName: "{{me}}.e.counter"
                  eventType: "Number"
                  eventValue: "{{C}}"
               400:
                - eventName: "{{me}}.e.error"
                  eventType: "String"
                  eventValue: "'Error with function ' + {{AuditorA}} + ' f sign ' + {{tokenA}}"
  - on: "E.{{me}}.e.counter > 0"
    resetAfter: 0
    name: counter1
    do:
     - print: "{{{{me}}.e.counter.value}}"
     - function: "{{BucketA}}.f.loop"
       params:
           counter: "{{{{me}}.e.counter.value}}"
       return:
           ref: counterA
           codes:
               200:
                 - eventName: "{{me}}.e.counter"
                   eventType: "Number"
                   eventValue: "{{counterA}}"
  - on: "E.{{me}}.e.signA"
    resetAfter: 30
    name: copy1
    do: 
     - function: "{{BucketA}}.f.send"
       params:
           remoteCall: "{{BucketB}}.f.receive"
           dataset: "{{Data001}}"
           token: "{{{{me}}.e.signA.value}}"
       return:
           ref: resultCopy1
           codes:
               200:
                - eventName: "{{me}}.e.copy1"
                  eventType: "String"
                  eventValue: "{{resultCopy1}}"
  - on: "E.{{me}}.e.copy1 && (E.{{me}}.e.counter == 0)"
    name: result1
    resetAfter: 30
    do:
     - function: "{{me}}.f.handleResult"
       params:
          result: "{{resultCopy1}}"
       result: null
  - on: "E.{{me}}.e.error"
    name: error
    resetAfter: 0
    do:
     - print: "{{{{me}}.e.error.value}}"    

   
